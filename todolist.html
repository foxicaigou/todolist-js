<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>待办清单</title>
</head>

<body>
    <header>
        <h1>待办清单</h1>
        <section>
            <label for="add">要做些什么呢？</label>
            <input id="add" type="text" placeholder="添加待办" required="required"></input>
        </section>
    </header>

    <section>
        <h2>正在进行中<span id="todocount">0</span></h2>
        <ol id="todolist"></ol>
    </section>

    <footer>今天又是元气满满的一天！</footer>

    <script>
        const add = document.querySelector("#add");
        const todolist = document.querySelector("#todolist");

        const todos = JSON.parse(localStorage.getItem("todos")) || [];

        render();


        add.addEventListener('keydown', keydownHandler);
        todolist.addEventListener("click", clickHandler);

        function keydownHandler(e) {
            // console.log(e.key);
            if (e.key = "Enter" && add.value.trim() !== "") {
                todos.push(add.value);
                localStorage.setItem("todos", JSON.stringify(todos));
                add.value = "";
                render();
            };
        }

        function clickHandler(e) {
            // console.log(e.target.tagName);
            // console.log(e.target.parentNode);console.log(e.target.parentElement);
            if (e.target.tagName !== "BUTTON")
                return;
            // 通过li和ol获取其索引
            let index = Array.from(todolist.children).indexOf(
                e.target.parentNode
            );
            // console.log(index);
            // console.log(todos[index]);
            todos.splice(index,1);
            render();
        }


        function render() {
            // 先删完
            todolist.replaceChildren();
            // 后更新
            localStorage.setItem("todos", JSON.stringify(todos));
            todos.forEach((content) => {
                let item = document.createElement("li");
                item.innerHTML = `${content}<button>删除</button>`;
                todolist.appendChild(item);
            });
        }

    </script>

</body>

</html>